<div class="container custom-container">
   <div class="page-header non-scrolled-page-header scrollable-page-header">
      <h2 class="green">Les paniers de
          <%= link_to farm_pointsdevente_sale_path(@farm, @sale.outlet, @sale) do %><span class="green">la vente <%= @outlet.full_name %> du </span><span class="green"><%= @sale.date.to_date.strftime('%-d') %>  <%= I18n.t(:month_names)[@sale.date.to_date.strftime('%b').to_sym]%></span>
        <% end %>
      </h2>
  </div>

  <div class="page-content">
  </div>
  <% @baskets.each_with_index do |basket, i| %>
    <div class="d-flex justify-content-between flex-wrap">
      <div class="dashboard-crop-plan-line-card dashboard-admin-event-card <%= @colors[i%3] %>">
        <div class="card-colored-top-part-fixed-color <%= @colors[i%3] %>">
          <div class="card-top-part-text"><%= basket.name %> x <%= basket.quantity %></div>
        </div>
        <div class="card-bottom-part">
          <div class="card-bottom-part-text p-0">
            <%= form_with model: @new_basket_line, url: farm_pointsdevente_sale_basket_basket_lines_path(@farm, @sale.outlet.id, @sale.id, basket), method: :post, local: true do |form| %>
              <table class="table basket-lines-table">
                <thead>
                  <tr>
                    <th scope="col" class="basket-product">L√©gume</th>
                    <th scope="col" class="basket-other-col">Unit√©</th>
                    <th scope="col" class="basket-other-col text-right">Qt√©</th>
                    <th scope="col" class="basket-other-col text-right">PU TTC</th>
                    <th scope="col" class="basket-other-col text-right d-none">HT</th>
                    <th scope="col" class="basket-other-col text-right">TTC</th>
                    <th scope="col" class="basket-last-col d-flex justify-content-end"></th>
                  </tr>
                </thead>
                <tbody>
                  <% basket.basket_lines.each do |basket_line| %>
                    <tr>
                      <td class="basket-product"><%= basket_line.product.name.capitalize %></td>
                      <td class="basket-other-col"><%= basket_line.unit %></td>
                      <td class="text-right basket-other-col"><%= remove_trailing_zero(basket_line.quantity) %></td>
                      <td class="text-right basket-other-col"><%= get_price_in_cents(basket_line.ttc_unit_price) %></td>
                      <td class="text-right basket-other-col d-none"><%= get_price_in_cents(basket_line.ht_total_price) %></td>
                      <td class="text-right basket-other-col"><%= get_price_in_cents(basket_line.ttc_total_price) %></td>
                      <td class="basket-last-col d-flex justify-content-end">
                        <%= link_to farm_pointsdevente_sale_basket_basket_line_path(@farm, @sale.outlet.id, @sale.id, basket.id, basket_line.id, ttc_actual_total: basket.ttc_actual_total, ht_actual_total: basket.ht_actual_total), method: :delete, local: true, data: { confirm: "T'es #{current_user.is_female? ? 's√ªre' : 's√ªr'} ? ü§®"} do %>
                          <div class="round-button red">
                            <i class="fas fa-times round-txt-button"></i>
                          </div>
                        <% end %>
                      </td>
                    </tr>
                  <% end %>
                  <tr class="total-basket-line">
                    <td class="basket-product"></td>
                    <td class="basket-other-col"></td>
                    <td class="basket-other-col"></td>
                    <td class="basket-other-col basket-ttc-actual-total">Total</td>
                    <td class="text-right basket-other-col basket-ttc-actual-total"><%= get_price_in_cents(basket.ttc_actual_total) %></td>
                    <td class="basket-last-col basket-ttc-actual-total d-flex justify-content-end"></td>
                  </tr>
                  <tr class="total-basket-line">
                    <td class="basket-product"></td>
                    <td class="basket-other-col"></td>
                    <td class="basket-other-col"></td>
                    <td class="basket-other-col">√âcart</td>
                    <td class="text-right basket-other-col"><%= get_price_in_cents(basket.ttc_price - basket.ttc_actual_total) %></td>
                    <td class="basket-last-col d-flex justify-content-end"></td>
                  </tr>
                </tbody>
              </table>
              <table class="table basket-lines-table new-basket-line-table">
                <tbody>
                  <tr class="new-sales-line">
                    <td class="basket-product"><%= form.select :product, @products %></td>
                    <td class="basket-other-col"><%= form.select :unit, ["-", "botte", "pi√®ce", "kg", "unit√©"] %></td>
                    <td style="text-align-last: end" class="basket-other-col"><%= form.number_field :quantity, step: 0.01, class: "quantity-column" %></td>
                    <td style="text-align-last: end" class="basket-other-col"><%= form.number_field :ttc_unit_price, step: 0.01, class: "price-column" %></td>
                    <%= form.hidden_field :ht_total, step: 0.01 %>
                    <td style="text-align-last: end" class="basket-other-col"><div><%= form.number_field :ttc_total, step: 0.01, class: "price-column" %></div></td>
                    <td class="d-flex justify-content-end basket-last-col d-flex justify-content-end" style="border-top: none"><%= form.submit value: "OK", 'data-disable-with': "..." %></td>
                  </tr>
                </tbody>
              </table>
            <% end %>
            </div>
          </div>
          <div class="d-flex justify-content-end">
            <div class="card-bottom-right-triangle <%= @colors[i%3] %> pointer" data-drawer-trigger aria-controls="drawer-previous-baskets-<%= basket.id %>"><i class="fas fa-search-plus"></i></div>
          </div>
        </div>
        <%= render "drawer_previous_baskets", basket: basket, farm: @farm, outlet: @sale.outlet %>
      <% end %>
    </div>
  </div>
</div>



